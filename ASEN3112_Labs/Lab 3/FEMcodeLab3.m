clear all
close all

L  = 12;        % in
L_E = 4.5;      % in
L_R = 5;        % in
w   = 1;        % in
h   = 1/8;      % in
h_E = 1/4;      % in
h_R = 0.040;    % in
E   = 10175000; % psi
rho = 0.0002505;% lb-sec^2/in^4

M_T = 1.1310*rho; % in^3 rho
S_T = 0.5655*rho; % in^4 rho
I_T = 23.124*rho; % in^5 rho

A    = w*h;
I_zz = w*h^3/12;

modelType = 2;

switch modelType
    
    case 2
        ne=2;

        c_M2 = rho*A*L/100800;
        c_K2 = 4*E*I_zz/L^3;
        
        M=c_M2*[19272,1458*L,5928,-642*L,0,0;
            1458*L,172*L^2,642*L,-73*L^2,0,0;
            5928,642*L,38544,0,5928,-642*L;
            -642*L,-73*L^2,0,344*L^2,642*L,-73*L^2;
            0,0,5928,642*L,19272,-1458*L;
            0,0,-642*L,-73*L^2,-1458*L,172*L^2] ...
            +[0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , M_T,  S_T;
            0 , 0 , 0 , 0 , S_T,  I_T];
        
        K=c_K2*[24,6*L,-24,6*L,0,0;
            6*L,2*L^2,-6*L,L^2,0,0;
            -24,-6*L,48,0,-24,6*L;
            6*L,L^2,0,4*L^2,-6*L,L^2;
            0,0,-24,-6*L,24,-6*L;
            0,0,6*L,L^2,-6*L,2*L^2];
    case 4
        ne=4;

        c_M4=rho*A*L/806400;
        c_K4=8*E*I_zz/L^3;
        M=c_M4*[77088, 2916*L,23712,-1284*L, 0, 0, 0, 0, 0, 0;
            2916*L, 172*L^2, 1284*L, -73*L^2, 0, 0, 0, 0, 0, 0;
            23712, 1284*L, 154176, 0, 23712, -1284*L, 0, 0, 0, 0;
            -1284*L, -73*L^2, 0, 344*L^2, 1284*L, -73*L^2, 0, 0, 0, 0;
            0, 0, 23712, 1284*L, 154176, 0, 23712, -1284*L, 0, 0;
            0, 0, -1284*L, -73*L^2, 0, 344*L^2, 1284*L, -73*L^2, 0, 0;
            0, 0, 0, 0, 23712, 1284*L, 154176, 0, 23712, -1284*L;
            0, 0, 0, 0, -1284*L, -73*L^2, 0, 344*L^2, 1284*L, -73*L^2;
            0, 0, 0, 0, 0, 0, 23712, 1284*L, 77088 , -2916*L;
            0, 0, 0, 0, 0, 0, -1284*L, -73*L^2, -2916*L , 172*L^2] ...
            + [0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , M_T,  S_T;
            0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , S_T,  I_T];
        
        K=c_K4*[ 96, 12*L, -96, 12*L, 0, 0, 0, 0, 0, 0;
                 12*L, 2*L^2, -12*L,L^2, 0, 0, 0, 0, 0, 0;
                -96, -12*L, 192, 0, -96, 12*L, 0, 0, 0, 0;
                 12*L,L^2, 0, 4*L^2, -12*L,L^2, 0, 0, 0, 0;
                 0,  0, -96, -12*L, 192, 0, -96, 12*L, 0, 0;
                 0, 0, 12*L,L^2, 0, 4*L^2, -12*L,L^2, 0, 0;
                 0, 0, 0, 0, -96, -12*L, 192, 0, -96, 12*L;
                 0, 0, 0, 0, 12*L,L^2, 0, 4*L^2, -12*L,L^2;
                 0, 0, 0, 0, 0, 0, -96, -12*L, 96, -12*L;
                 0, 0, 0, 0, 0, 0, 12*L,L^2, -12*L, 2*L^2;];
    otherwise
        error('incorrect model');
end

M_red=M(3:end,3:end);
K_red=K(3:end,3:end);

% [ev_red,el]=eig(M_red\K_red);
[ev_red,el]=eig(K_red,M_red);
omega=real(sqrt(diag(el)));

omega(1:3)/2/pi

[frq,isx]=sort(1/2/pi*omega);

ev_red=ev_red(:,isx);

ev=0*K;
ev(3:end,3:end)=ev_red;

nsub=10;
scale=1.0;

nv=ne*nsub+1;
Le=L/ne;
dx=Le/nsub;

for t=3:5 %size(ev,2)
    
    k=0;
    x=zeros(nv,1);
    v=zeros(nv,1);
    
    for e=1:ne
        
        xxi=Le*(e-1);
        vi=ev(2*e-1,t);
        teti=ev(2*e,t);
        vj=ev(2*e+1,t);
        tetj=ev(2*e+2,t);
        
        if (e==1); ni=0;else; ni=1;end
        
        for n=ni:nsub
            
            xk=xxi+dx*n;
            xi=(2*n-nsub)/nsub;
            vk=scale*(0.125*(4*(vi+vj)+2*(vi-vj)*(xi^2-3)*xi+Le*(xi^2-1)*(tetj-teti+(teti+tetj)*xi)));
            
            k=k+1;
            x(k)=xk;
            v(k)=vk;
        end
    end
    
    plot(x,v); hold on;
end
